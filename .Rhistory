pp <- list(layout.widths = list(left.padding = 0, right.padding = 0),
layout.heights = list(top.padding = 0, bottom.padding = 0))
r2 <- ranef(fit5, condVar = TRUE)
d2 <- lattice::dotplot(r2, par.settings = pp)
gridExtra::grid.arrange(d2$scientificName, d$PubID, nrow = 1)
gridExtra::grid.arrange(d2$scientificName, d2$PubID, nrow = 1)
d <- glmer(Severity ~ LandmassType + (1|scientificName) + (1|PubID), family = binomial, data = Impact_landmass)
f <- glmer(Severity ~ LandmassType + (1|scientificName), family = binomial, data = Impact_landmass)
anova(d,f)
gc()
#Wilcoxon rank sum test: search returns vs socioeconomic pest status
rstatix::wilcox_test(Literature, formula = SearchReturns ~ SEPest)
rstatix::wilcox_effsize(Literature, formula = SearchReturns ~ SEPest)
m1
anova(mnull, m3, m2, m1)
mnull <- glmer(Evidence ~ 1 + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
anova(mnull, m3, m2, m1)
m2 <- glmer(Evidence ~ log(SearchReturns) + SEPest + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
m3 <- glmer(Evidence ~ log(SearchReturns) + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
anova(mnull, m3, m2, m1)
stepAIC(m1, direction = "backward")
summary(m1)
#DO socio-economic pests have more environmental impact information?
m1 <- glmer(Evidence ~ log(SearchReturns) * SEPest + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
anova(mnull, m3, m2, m1)
stepAIC(m1, direction = "backward")
MuMIn::r.squaredGLMM(m1, mnull)
m4 <- glm(Evidence ~ log(SearchReturns) * SEPest,
family = poisson, data = Literature)
anova(m1,m4)
res1 <- simulateResiduals(m1, plot = T, refit = F)
library(DHARMa)
res1 <- simulateResiduals(m1, plot = T, refit = F)
res2 <- simulateResiduals(m2, plot = T, refit = F)
anova(m1,m2)
testDispersion(m1)
testDispersion(res1)
testDispersion(fit4)
testOverdispersion(res1)
gc()
library(tidyverse)
library(janitor)
library(sf)
library(terra)
library(readxl)
library(tmap)
library(ggpol) #facet_share
library(ggpubr) #balloon plots
library(MASS)
library(PNWColors)
library(ncdf4)
library(lme4)
library(geepack)
library(rstatix)
library(coin)
library(DHARMa)
Pool <- read_excel(file.path("Data", "Species_pool.xlsx"),
sheet = "Pool")
Literature <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Literature_searches")
Impacts <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Assessment_results_input")
Impact_Distribution <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Impact_distribution")
# Obtained from Global Register of Introduced and Invasive Species
#DOI: 10.5281/zenodo.63481164
Insect_Distribution <- read.csv(file.path("Data","GRIIS - Country Compendium V1_0.csv")) %>%
filter(class == "Insecta")
##Spatial data
#~# Load GADM level 0 shapefile (https://www.gadm.org)
load(file.path("Data","lvl_0.RData"))
#Convert shapefile to sf object
lvl_0_sf <- st_as_sf(lvl_0)
lvl_0_sf <- st_transform(lvl_0_sf, crs = "+proj=moll") #Mollweide projection
rm(lvl_0)
#~# Load GADM level 1 shapefile (https://www.gadm.org)
load(file.path("Data","lvl_1.RData"))
#Convert shapefile to sf object
lvl_1_sf <- st_as_sf(lvl_1)
lvl_1_sf <- st_transform(lvl_1_sf, crs = "+proj=moll") #Mollweide projection
rm(lvl_1)
p <- "C:/Users/dcla0008/Dropbox/PhD/Thesis/Data/Chapter 2/Data/high-seas-master/geo-data/XYPorts_CM_Cruse_anchorage_world2_final.shp"
ports <- st_read(p)
ports_country <- ports %>%
group_by(ISO3166A3) %>%
summarise(length(LOCODE)) %>%
st_drop_geometry()
source("R/2.data_preparation.R")
m1 <- glmer(Evidence ~ log(SearchReturns) * SEPest + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
m2 <- glmer(Evidence ~ log(SearchReturns) + SEPest + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
m3 <- glmer(Evidence ~ log(SearchReturns) + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
mnull <- glmer(Evidence ~ 1 + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
m4 <- glm(Evidence ~ log(SearchReturns) * SEPest, family = poisson, data = Literature)
anova(mnull, m3, m2, m1)
#m1 is the "best" model
anova(m1,m4)
summary(m1)
res1 <- simulateResiduals(m1, plot = T, refit = F)
res2 <- simulateResiduals(m2, plot = T, refit = F)
Literature
ggplot(Literature, aes(x = SEPest, y = Evidence)) +
geom_boxplot() +
scale_y_log10() +
theme_bw() +
theme(axis.line = element_line(colour = "black"),
axis.title = element_text(size = 16),
axis.text = element_text(size = 14, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
xlab("Socioeconomic pest status") +
ylab("Number of search returns (log10)")
ggplot(Literature, aes(x = SEPest, y = Evidence)) +
geom_boxplot() +
theme_bw() +
theme(axis.line = element_line(colour = "black"),
axis.title = element_text(size = 16),
axis.text = element_text(size = 14, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
xlab("Socioeconomic pest status") +
ylab("Number of search returns (log10)")
ggplot(Literature, aes(x = SEPest, y = log1p(Evidence))) +
geom_boxplot() +
theme_bw() +
theme(axis.line = element_line(colour = "black"),
axis.title = element_text(size = 16),
axis.text = element_text(size = 14, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
xlab("Socioeconomic pest status") +
ylab("Number of search returns (log1p)")
summary(m1)
coefplot2::coefplot2(m1, intercept = TRUE, main = "Fixed effect coefficient")
ggplot(Literature, aes(x = SEPest, y = SearchReturns)) +
geom_boxplot() +
scale_y_log10() +
theme_bw() +
theme(axis.line = element_line(colour = "black"),
axis.title = element_text(size = 16),
axis.text = element_text(size = 14, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank()) +
xlab("Socioeconomic pest status") +
ylab("Number of search returns (log10)")
summary(m2)
fitted(m1)
m1@frame
data.frame(fitted(m1), m1@frame)
plot(m1@frame$Evidence, fitted(m1))
summary(m1)
anova(mnull, m3, m2, m1)
coefplot2::coefplot2(m1, ptype = "vcov", intercept = TRUE, main = "Random effect variance")
summary(m1)
r2 <- ranef(m1, condVar = TRUE)
d2 <- lattice::dotplot(r2, par.settings = pp)
pp <- list(layout.widths = list(left.padding = 0, right.padding = 0),
layout.heights = list(top.padding = 0, bottom.padding = 0))
r2 <- ranef(m1, condVar = TRUE)
d2 <- lattice::dotplot(r2, par.settings = pp)
gridExtra::grid.arrange(d2$scientificName, d2$Order, nrow = 1)
sqrt(2.8866)
summary(m1)
ranef(m1)
##log-linear analysis
Order_assessed <- species_assessed_min %>%
dplyr::select(Order, Evidence, DataDeficient) %>%
rename(NotDD = "Evidence") %>%
rename(DD = "DataDeficient") %>%
gather(key = "Assessed", value = "Number", -Order)
fit.1 <- glm(Number ~ factor(Order) * factor(Assessed), data = Order_assessed, family = poisson)
fit.2 <- glm(Number ~ factor(Order) + factor(Assessed), data = Order_assessed, family = poisson)
anova(fit.2, fit.1, test = "Chisq")
summary(fit.2)
summary(fit.1)
summary(fit.1)
Order_assessed
exp(2.231e-01)
anova(fit.2, fit.1, test = "Chisq")
DDvsNonDD <- species_assessed_min %>%
dplyr::select(Order, DD, NotDD) %>%
mutate(DD = DD * -1) %>%
gather("Status", "Proportion", -Order) %>%
arrange(Proportion)
#Proportion of DD/nonDD species per order
info_plot <- ggplot(DDvsNonDD, aes(x = reorder(Order, desc(Proportion)), y = Proportion, fill = Status)) +
geom_bar(stat = "identity") +
facet_share(~Status, dir = "h", scales = "free", reverse_num = F) +
coord_flip() +
theme(axis.line = element_line(colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_blank(),
axis.title = element_text(size = 16),
axis.text.y = element_text(size = 14, colour = "black"),
axis.text.x = element_text(size = 14, colour = "black"),
strip.text = element_text(size = 16),
legend.title = element_text(size = 16),
legend.text = element_text(size = 14)) +
scale_fill_manual("Status", values = c("DD" = "black", "NotDD" = "orange")) +
scale_y_continuous(breaks = c(-1.00, -0.75, -0.50, -0.25, 0.00, 0.00, 0.25, 0.50, 0.75, 1.00),
labels = c("1.00", "0.75", "0.50", "0.25", "0.00", "0.00", "0.25", "0.50", "0.75", "1.00")) +
ylab("Proportion of species assessed") +
xlab("Order")
info_plot
summary(fit.2)
summary(fit.1)
summary(fit.2)
exp(-0.5235)
summary(fit.1)
#Cumulative link models
cm1 <- ordinal::clmm(Severity ~ log(Total_area) + Total_ports + AlienCountries + (1|Order), data = na.omit(MaxSev_range), nAGQ = 10)
cm2 <- ordinal::clm(Severity ~ log(Total_area) + Total_ports + AlienCountries, data = na.omit(MaxSev_range), nAGQ = 10)
cm3 <- ordinal::clm(Severity ~ log(Total_area) + AlienCountries, data = na.omit(MaxSev_range), nAGQ = 10)
#Confirms that cm4 is the "best" model.
step.model <- stepAIC(cm2, direction = "backward", trace = 1)
anova(cm2,cm5) #significant difference between models
cm5 <- ordinal::clm(Severity ~ 1, data = cm3$model, nAGQ = 50)
anova(cm2,cm5) #significant difference between models
cm5 <- ordinal::clm(Severity ~ 1, data = cm2$model, nAGQ = 50)
anova(cm2,cm5) #significant difference between models
cm4 <- ordinal::clm(Severity ~ AlienCountries, data = na.omit(MaxSev_range), nAGQ = 10)
anova(cm2,cm4) #no significant difference including area or ports
cm5 <- ordinal::clm(Severity ~ 1, data = cm4$model, nAGQ = 50)
anova(cm4,cm5) #significant difference between models
?stepAIC
ordinal::nominal_test(cm4) ## no evidence of non-proportional odds.
ordinal::scale_test(cm4) ## no evidence of scale effects.
#Confidence intervals
pr <- profile(cm4)
plot(pr)
exp(confint(pr))
summary(cm4)
exp(0.02585)
pr <- profile(exp(cm4))
pr <- exp(profile(cm4))
pr
plot(exp(pr))
pr
anova(cm4, type = "III")
anova(cm4)
summary(cm4)
exp(0.5931114)
slice.fm1 <- slice(cm4, lambda = 5)
slice.fm1 <- ordinal::slice(cm4)
plot(slice.fm1)
slice.fm1 <- ordinal::slice(cm4, lambda = 5)
par(mfrow = c(2, 3))
plot(slice.fm1)
slice.fm1 <- ordinal::slice(cm4, lambda =  1e-5)
plot(slice.fm1)
convergence(cm4)
ordinal::convergence(cm4)
##Do islands have more harmful impacts than mainland?
#Only using studies once; removed laboratory-only studies
#Keep all variables for GLMM
Impact_landmass <- Impacts.nonDD %>%
distinct(PubID = PubID, .keep_all = T) %>%
dplyr::filter(StudyType != "Laboratory") %>%
mutate(Severity = ifelse(Severity == "MO"| Severity == "MR", "Harmful", "NotHarmful")) %>%
mutate_if(is.character, as.factor) %>%
left_join(Literature, by = "scientificName")
#Binomial GLMM. Include area given that islands are typically smaller
fit <- glmer(Severity ~ LandmassType * log(distance) + log(area) + (1|scientificName), family = binomial, data = Impact_landmass)
fit2 <- glmer(Severity ~ LandmassType + log(distance) + log(area) + (1|scientificName), family = binomial, data = Impact_landmass)
anova(fit, fit2)
stepAIC(fit)
fit <- glmer(Severity ~ LandmassType * log(distance) * log(area) + (1|scientificName), family = binomial, data = Impact_landmass)
summary(fit)
fit <- glmer(Severity ~ LandmassType * log(distance) + log(area) + (1|scientificName), family = binomial, data = Impact_landmass)
fit2 <- glmer(Severity ~ LandmassType + log(distance) + log(area) + (1|scientificName), family = binomial, data = Impact_landmass)
fit3 <- glmer(Severity ~ LandmassType + log(distance) + (1|scientificName), family = binomial, data = Impact_landmass)
fit4 <- glmer(Severity ~ LandmassType + (1|scientificName), family = binomial, data = Impact_landmass)
fit5 <- glm(Severity ~ LandmassType, family = binomial, data = Impact_landmass)
#Including distance to the equator does nothing to improve model
anova(fit4, fit5)
#No effect of a landmass type x distance to equator interaction
anova(fit3,fit4)
#No effect of a landmass type x distance to equator interaction
anova(fit2,fit3)
#Including area to the equator does nothing to improve model
anova(fit3,fit4)
anova(fit4)
summary(fit4)
coefplot2::coefplot2(fit4, intercept = TRUE, main = "Fixed effect coefficient")
pp <- list(layout.widths = list(left.padding = 0, right.padding = 0),
layout.heights = list(top.padding = 0, bottom.padding = 0))
r2 <- ranef(fit4, condVar = TRUE)
d2 <- lattice::dotplot(r2, par.settings = pp)
gridExtra::grid.arrange(d2$scientificName, nrow = 1)
MaxSev_range
plot(MaxSev_range$AlienCountries, MaxSev_range$Evidence)
dev.off()
plot(MaxSev_range$AlienCountries, MaxSev_range$Evidence)
cor(MaxSev_range$AlienCountries, MaxSev_range$Evidence)
cor(log(MaxSev_range$AlienCountries), MaxSev_range$Evidence)
cor(log(MaxSev_range$AlienCountries), log(MaxSev_range$Evidence))
library(rstatix)
citation("rstatix")
citation("lme4")
citation("ordinal")
citation("sfl")
citation("sf")
library(tidyverse)
library(janitor)
library(sf)
library(terra)
library(readxl)
library(tmap)
library(ggpol) #facet_share
library(ggpubr) #balloon plots
library(MASS)
library(PNWColors)
library(ncdf4)
library(lme4)
library(geepack)
library(rstatix)
library(coin)
library(DHARMa)
#Package "rms" needs to be installed
########################################### Load data ###############################################
#~# Load impact data
Pool <- read_excel(file.path("Data", "Species_pool.xlsx"),
sheet = "Pool")
Literature <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Literature_searches")
Impacts <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Assessment_results_input")
Impact_Distribution <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Impact_distribution")
# Obtained from Global Register of Introduced and Invasive Species
#DOI: 10.5281/zenodo.63481164
Insect_Distribution <- read.csv(file.path("Data","GRIIS - Country Compendium V1_0.csv")) %>%
filter(class == "Insecta")
##Spatial data
#~# Load GADM level 0 shapefile (https://www.gadm.org)
load(file.path("Data","lvl_0.RData"))
#Convert shapefile to sf object
lvl_0_sf <- st_as_sf(lvl_0)
lvl_0_sf <- st_transform(lvl_0_sf, crs = "+proj=moll") #Mollweide projection
rm(lvl_0)
#~# Load GADM level 1 shapefile (https://www.gadm.org)
load(file.path("Data","lvl_1.RData"))
#Convert shapefile to sf object
lvl_1_sf <- st_as_sf(lvl_1)
lvl_1_sf <- st_transform(lvl_1_sf, crs = "+proj=moll") #Mollweide projection
rm(lvl_1)
source("R/2.data_preparation.R")
rm(list = ls())
Pool <- read_excel(file.path("Data", "Species_pool.xlsx"),
sheet = "Pool")
Literature <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Literature_searches")
Impacts <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Assessment_results_input")
Impact_Distribution <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Impact_distribution")
# Obtained from Global Register of Introduced and Invasive Species
#DOI: 10.5281/zenodo.63481164
Insect_Distribution <- read.csv(file.path("Data","GRIIS - Country Compendium V1_0.csv")) %>%
filter(class == "Insecta")
##Spatial data
#~# Load GADM level 0 shapefile (https://www.gadm.org)
load(file.path("Data","lvl_0.RData"))
#Convert shapefile to sf object
lvl_0_sf <- st_as_sf(lvl_0)
lvl_0_sf <- st_transform(lvl_0_sf, crs = "+proj=moll") #Mollweide projection
rm(lvl_0)
#~# Load GADM level 1 shapefile (https://www.gadm.org)
load(file.path("Data","lvl_1.RData"))
#Convert shapefile to sf object
lvl_1_sf <- st_as_sf(lvl_1)
lvl_1_sf <- st_transform(lvl_1_sf, crs = "+proj=moll") #Mollweide projection
rm(lvl_1)
p <- "C:/Users/dcla0008/Dropbox/PhD/Thesis/Data/Chapter 2/Data/high-seas-master/geo-data/XYPorts_CM_Cruse_anchorage_world2_final.shp"
ports <- st_read(p)
ports_country <- ports %>%
group_by(ISO3166A3) %>%
summarise(length(LOCODE)) %>%
st_drop_geometry()
source("R/2.data_preparation.R")
cm4 <- ordinal::clm(Severity ~ AlienCountries, data = na.omit(MaxSev_range), nAGQ = 10)
ordinal::nominal_test(cm4) ## no evidence of non-proportional odds.
anova(cm4)
anova(cm4, type = "III")
anova(cm4, type = "II")
##Do islands have more harmful impacts than mainland?
#Only using studies once; removed laboratory-only studies
#Keep all variables for GLMM
Impact_landmass <- Impacts.nonDD %>%
distinct(PubID = PubID, .keep_all = T) %>%
dplyr::filter(StudyType != "Laboratory") %>%
mutate(Severity = ifelse(Severity == "MO"| Severity == "MR", "Harmful", "NotHarmful")) %>%
mutate_if(is.character, as.factor) %>%
left_join(Literature, by = "scientificName")
fit4 <- glmer(Severity ~ LandmassType + (1|scientificName), family = binomial, data = Impact_landmass)
anova(fit4)
anova(fit4, type = "III")
plot(fit4)
res1 <- DHARMa::simulateResiduals(fit4, plot = T, refit = F)
summary(fit4)
library(tidyverse)
library(janitor)
library(sf)
library(terra)
library(readxl)
library(tmap)
library(ggpol) #facet_share
library(ggpubr) #balloon plots
library(MASS)
library(PNWColors)
library(ncdf4)
library(lme4)
library(geepack)
library(rstatix)
library(coin)
library(DHARMa)
Pool <- read_excel(file.path("Data", "Species_pool.xlsx"),
sheet = "Pool")
Literature <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Literature_searches")
Impacts <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Assessment_results_input")
Impact_Distribution <- read_excel(file.path("Data", "Assessment_information.xlsx"),
sheet = "Impact_distribution")
# Obtained from Global Register of Introduced and Invasive Species
#DOI: 10.5281/zenodo.63481164
Insect_Distribution <- read.csv(file.path("Data","GRIIS - Country Compendium V1_0.csv")) %>%
filter(class == "Insecta")
##Spatial data
#~# Load GADM level 0 shapefile (https://www.gadm.org)
load(file.path("Data","lvl_0.RData"))
#Convert shapefile to sf object
lvl_0_sf <- st_as_sf(lvl_0)
lvl_0_sf <- st_transform(lvl_0_sf, crs = "+proj=moll") #Mollweide projection
rm(lvl_0)
#~# Load GADM level 1 shapefile (https://www.gadm.org)
load(file.path("Data","lvl_1.RData"))
#Convert shapefile to sf object
lvl_1_sf <- st_as_sf(lvl_1)
lvl_1_sf <- st_transform(lvl_1_sf, crs = "+proj=moll") #Mollweide projection
rm(lvl_1)
gc()
p <- "C:/Users/dcla0008/Dropbox/PhD/Thesis/Data/Chapter 2/Data/high-seas-master/geo-data/XYPorts_CM_Cruse_anchorage_world2_final.shp"
ports <- st_read(p)
ports_country <- ports %>%
group_by(ISO3166A3) %>%
summarise(length(LOCODE)) %>%
st_drop_geometry()
source("R/2.data_preparation.R")
##Do islands have more harmful impacts than mainland?
#Only using studies once; removed laboratory-only studies
#Keep all variables for GLMM
Impact_landmass <- Impacts.nonDD %>%
distinct(PubID = PubID, .keep_all = T) %>%
dplyr::filter(StudyType != "Laboratory") %>%
mutate(Severity = ifelse(Severity == "MO"| Severity == "MR", "Harmful", "NotHarmful")) %>%
mutate_if(is.character, as.factor) %>%
left_join(Literature, by = "scientificName")
Impact_landmass
length(unique(Impact_landmass$scientificName))
length(unique(Impact_landmass$PubID))
sum(80,1)
sum(80,56,9,4,2,214,7,8,2,12,58,7,10,3,15)
Impact_landmass
length(unique(Impact_landmass$Order.x))
Impacts.nonDD
Ins_Dist
Impacts.nonDD
unique(Impacts.nonDD[c("scientificName", "Country")])
View(Impacts.nonDD)
df <- unique(Impacts.nonDD[c("scientificName", "Country")])
View(df)
df2 <- unique(Impacts.nonNA[c("scientificName", "Country")])
df2 <- unique(Impacts.noNA[c("scientificName", "Country")])
length(unique(df$scientificName))
df3 <- unique(Impacts[c("scientificName", "Country")])
df3 <- unique(Insect_Distribution[c("scientificName", "Country")])
View(Insect_Distribution_min)
df3 <- unique(Insect_Distribution_min[c("species", "country")])
rm(df3)
rm(df2)
df
Impacts.nonDD %>% filter(IPBESRegion == "Americas")
ams <- Impacts.nonDD %>% filter(IPBESRegion == "Americas")
nrow(ams)
508/867
ams
ams %>% filter(IPBESSubregion == "North America")
na <- ams %>% filter(IPBESSubregion == "North America")
nrow(na)
423/508
#DO socio-economic pests have more environmental impact information?
m1 <- glmer(Evidence ~ log(SearchReturns) * SEPest + (1|Order) + (1|scientificName),
family = poisson, data = Literature)
summary(m1)
